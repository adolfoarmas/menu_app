/*
	MIT License http://www.opensource.org/licenses/mit-license.php
	Author Tobias Koppers @sokra
*/

"use strict";

<<<<<<< HEAD
/** @typedef {import("../Module").BuildMeta} BuildMeta */
=======
>>>>>>> ab4424251e3c4a3188491801dfcd1cc2364c65cb
/** @typedef {import("../Parser").ParserState} ParserState */

/** @type {WeakMap<ParserState, boolean>} */
const parserStateExportsState = new WeakMap();

/**
 * @param {ParserState} parserState parser state
 * @returns {void}
 */
exports.bailout = parserState => {
	const value = parserStateExportsState.get(parserState);
	parserStateExportsState.set(parserState, false);
	if (value === true) {
<<<<<<< HEAD
		const buildMeta = /** @type {BuildMeta} */ (parserState.module.buildMeta);
		buildMeta.exportsType = undefined;
		buildMeta.defaultObject = false;
=======
		parserState.module.buildMeta.exportsType = undefined;
		parserState.module.buildMeta.defaultObject = false;
>>>>>>> ab4424251e3c4a3188491801dfcd1cc2364c65cb
	}
};

/**
 * @param {ParserState} parserState parser state
 * @returns {void}
 */
exports.enable = parserState => {
	const value = parserStateExportsState.get(parserState);
	if (value === false) return;
	parserStateExportsState.set(parserState, true);
	if (value !== true) {
<<<<<<< HEAD
		const buildMeta = /** @type {BuildMeta} */ (parserState.module.buildMeta);
		buildMeta.exportsType = "default";
		buildMeta.defaultObject = "redirect";
=======
		parserState.module.buildMeta.exportsType = "default";
		parserState.module.buildMeta.defaultObject = "redirect";
>>>>>>> ab4424251e3c4a3188491801dfcd1cc2364c65cb
	}
};

/**
 * @param {ParserState} parserState parser state
 * @returns {void}
 */
exports.setFlagged = parserState => {
	const value = parserStateExportsState.get(parserState);
	if (value !== true) return;
<<<<<<< HEAD
	const buildMeta = /** @type {BuildMeta} */ (parserState.module.buildMeta);
=======
	const buildMeta = parserState.module.buildMeta;
>>>>>>> ab4424251e3c4a3188491801dfcd1cc2364c65cb
	if (buildMeta.exportsType === "dynamic") return;
	buildMeta.exportsType = "flagged";
};

/**
 * @param {ParserState} parserState parser state
 * @returns {void}
 */
exports.setDynamic = parserState => {
	const value = parserStateExportsState.get(parserState);
	if (value !== true) return;
<<<<<<< HEAD
	/** @type {BuildMeta} */
	(parserState.module.buildMeta).exportsType = "dynamic";
=======
	parserState.module.buildMeta.exportsType = "dynamic";
>>>>>>> ab4424251e3c4a3188491801dfcd1cc2364c65cb
};

/**
 * @param {ParserState} parserState parser state
 * @returns {boolean} true, when enabled
 */
exports.isEnabled = parserState => {
	const value = parserStateExportsState.get(parserState);
	return value === true;
};
